<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fade‑Trend Risk Calculator</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* custom scroll for results */
    #results::-webkit-scrollbar { height: 8px; }
    #results::-webkit-scrollbar-track { background: transparent; }
    #results::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 9999px; }
  </style>
</head>
<body class="bg-slate-50 antialiased p-4">
  <h1 class="text-3xl font-bold mb-4 text-center">Fade‑Trend Risk Calculator</h1>

  <div class="max-w-4xl mx-auto grid gap-6">
    <!-- Input Card -->
    <div class="bg-white shadow-xl rounded-2xl p-6">
      <h2 class="text-xl font-semibold mb-4">Move Parameters</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div>
          <label class="block mb-1 font-medium" for="startPrice">Start Price</label>
          <input id="startPrice" type="number" step="0.25" class="w-full border rounded-xl p-2" value="4600" />
        </div>
        <div>
          <label class="block mb-1 font-medium" for="endPrice">End Price</label>
          <input id="endPrice" type="number" step="0.25" class="w-full border rounded-xl p-2" value="4620" />
        </div>
        <div>
          <label class="block mb-1 font-medium" for="accountSize">Account Size ($)</label>
          <input id="accountSize" type="number" step="100" class="w-full border rounded-xl p-2" value="50000" />
        </div>
        <div>
          <label class="block mb-1 font-medium" for="riskList">Risk % List (comma-sep)</label>
          <input id="riskList" type="text" class="w-full border rounded-xl p-2" value="0.5,1,2" />
        </div>
        <div>
          <label class="block mb-1 font-medium" for="instrument">Instrument</label>
          <select id="instrument" class="w-full border rounded-xl p-2">
            <option value="ES">ES (S&P 500)</option>
            <option value="NQ" selected>NQ (Nasdaq-100)</option>
          </select>
        </div>
      </div>
      <button id="calcBtn" class="mt-6 w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-2xl shadow-md transition">Calculate</button>
    </div>

    <!-- Output Card -->
    <div class="bg-white shadow-xl rounded-2xl p-6">
      <h2 class="text-xl font-semibold mb-4">Results</h2>
      <div id="results" class="text-base leading-relaxed space-y-6 overflow-x-auto"></div>
    </div>
  </div>

  <script>
    const pointValues = {
      ES: { micro: 5, mini: 50 },
      NQ: { micro: 2, mini: 20 },
    };

    const moneyFmt = (num) => num.toLocaleString(undefined, { style: "currency", currency: "USD", maximumFractionDigits: 0 });
    const numFmt = (num, digits = 2) => num.toLocaleString(undefined, { maximumFractionDigits: digits });

    function parseRiskList(str) {
      return str
        .split(",")
        .map((x) => parseFloat(x.trim()))
        .filter((x) => !isNaN(x) && x > 0)
        .slice(0, 3);
    }

    function calculate() {
      const start = parseFloat(document.getElementById("startPrice").value);
      const end = parseFloat(document.getElementById("endPrice").value);
      const accountSize = parseFloat(document.getElementById("accountSize").value);
      const riskListStr = document.getElementById("riskList").value;
      const instrument = document.getElementById("instrument").value;

      if (!start || !end || !accountSize) return;

      const range = end - start; // may be negative
      // Entry at 5/8 (0.625) of the full move from start
      const entry = start + 0.625 * range;
      const stop = end; // stop at end of impulse
      const target = start + 0.25 * range; // 1/4 from start

      const stopPts = Math.abs(entry - stop);
      const rewardPts = Math.abs(entry - target);
      const rMultipleBase = stopPts ? rewardPts / stopPts : 0;

      const riskPercents = parseRiskList(riskListStr);

      let html = `
        <p><strong>Entry Price:</strong> ${numFmt(entry)} &nbsp; | &nbsp; <strong>Stop-Loss:</strong> ${numFmt(stop)} &nbsp; | &nbsp; <strong>Take-Profit:</strong> ${numFmt(target)}</p>
        <p><strong>Stop Distance:</strong> ${numFmt(stopPts)} pts &nbsp; | &nbsp; <strong>Reward Distance:</strong> ${numFmt(rewardPts)} pts &nbsp; | &nbsp; <strong>Reward-to-Risk:</strong> ${rMultipleBase ? numFmt(rMultipleBase, 2) + " R" : "–"}</p>`;

      riskPercents.forEach((rp) => {
        const cashRiskAllowed = accountSize * (rp / 100);

        html += `
          <div class="border-t pt-4 mt-4">
            <h3 class="text-lg font-semibold mb-2">Risk ${numFmt(rp)}% (${moneyFmt(cashRiskAllowed)})</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        `;

        ["micro", "mini"].forEach((ct) => {
          const ptVal = pointValues[instrument][ct];
          const $riskPerContract = stopPts * ptVal;
          const contractsAllowed = $riskPerContract ? Math.floor(cashRiskAllowed / $riskPerContract) : 0;
          const posRisk = contractsAllowed * $riskPerContract;
          const posReward = rewardPts * ptVal * contractsAllowed;

          const cardColor = contractsAllowed > 0 ? "bg-green-200" : "bg-red-200";

          html += `
            <div class="rounded-xl p-4 shadow-inner ${cardColor}">
              <h4 class="text-md font-semibold mb-1 uppercase">${ct}</h4>
              <p><strong>Point Value:</strong> $${ptVal}</p>
              <p><strong>Risk / Contract:</strong> ${moneyFmt($riskPerContract)}</p>
              <p><strong>Contracts Allowed:</strong> ${contractsAllowed}</p>
              <p><strong>Position Risk:</strong> ${moneyFmt(posRisk)}</p>
              <p><strong>Potential Reward:</strong> ${moneyFmt(posReward)}</p>
            </div>
          `;
        });

        html += "</div></div>";
      });

      document.getElementById("results").innerHTML = html;
    }

    document.getElementById("calcBtn").addEventListener("click", calculate);
    document.querySelectorAll("#startPrice,#endPrice,#accountSize,#riskList,#instrument").forEach((el) => el.addEventListener("input", calculate));

    // initial render
    calculate();
  </script>
</body>
</html>
